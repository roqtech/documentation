import { Steps, Callout } from "nextra/components"

# Quickstart

Learn how to create a Next.js project, install ROQ BaaS SDK, add signup button, login button, and query data from the ROQ BaaS.

<Steps>
### Prerequisites

Before we can begin, we must first create an initial project. Please create a new project by visiting [**ROQ AI Assistant**](https://app.roq.ai/). This initial project will create a Backend-as-a-Service or BaaS instance that provides APIs.

After creating the project, you will receive an email invitation to access the project console. Accept the invitation, go to the project console and sign up if you don't have an account on [**ROQ Console**](https://console.roq.tech/).

### Create a Next.js application

To create a new Next.js project. Run this command:

```shell
npx create-next-app@latest
```

And the follow along the installation questions:

![question](/screenshots/next-js-page-project.png)

We will use Next.js with Page Router in this quickstart

### Install ROQ BaaS SDK

Install the necessary ROQ BaaS SDK for our project, which is `@roq/nextjs` and `@roq/cli` packages. 

```shell
npm install @roq/nextjs --save
npm install @roq/cli --save-dev
```

### Setup `.env`

Besides SDK, we need to copy the environment file from the ROQ Console. Make sure to choose the appropriate environment for our project, copy the environment values, and save it to the `.env` file in our root Next.js project directory. 

<Callout type="info">
Make sure to include the `.env` file in the `.gitignore` file. So that the environment variables are not exposed to the public.
</Callout>

Go to the project console and select the project and the environment then copy the environment values from the console.

![copy env from console](/gifs/copy-env-from-console.gif)

Create file `.env` in the root directory of the Next.js project and paste the environment values. 

<Callout type="info">
It is recommended to change the `ROQ_SECRET` environment value in copied `.env` into a more secure value. The default value is `CHANGE_THIS_SECRET`.
</Callout>
### Generate SDK

Our Next.js project will work with ROQ BaaS by using a customized generated SDK. This process is necessary to generate Prisma types for SDK. To generate it, run the command below:

```shell
npx @roq/cli generate
```
The command generates a customizable SDK based on the Prisma BaaS schema and chosen environment. The default location for the code generated is `src/lib/roq`.

![generate roq sdk](/screenshots/generate-sdk.png)

Add `src/lib/roq` folder to the `compilerOptions` in the TypeScript config file `tsconfig.json` so that the new SDK can be recognized. The `tsconfig.json` located in the root directory of the Next.js project.

before:

```json filename="tsconfig.json"
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

after: 

```json filename="tsconfig.json"
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"],
      "lib/*": ["./src/lib/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

<Callout type="info">
If any changes are made to the project schema or entities after the project creation and SDK generation, we can update the SDK by running the command `npx @roq/cli generate` again. To modify the project schema, we can use the [Schema Editor](/schema-editor) available on the ROQ Console.
</Callout>

### Configure Next.js with ROQ authentication

Before doing any data-related query, we need to wrap the Next.js application with the `<RoqClientProvider>` context provider component. This provider enables the components in the application tree to access the customized generated SDK from our earlier command. You can put this code in the `_app.tsx` file.

```jsx filename="_app.tsx"
import '@/styles/globals.css'
import type { AppProps } from 'next/app'
import { RoqClientProvider } from 'lib/roq'
import { RoqProvider} from '@roq/nextjs';

export default function App({ Component, pageProps }: AppProps) {
  const backendHost = process.env.NEXT_PUBLIC_ROQ_API_URL as string
  const platformHost = process.env.NEXT_PUBLIC_ROQ_PLATFORM_URL as string

  return (
    <RoqProvider
      config={{
        host: platformHost,
        auth: {
          useRoqAuth: true,
        },
      }}
    >
      <RoqClientProvider backendHost={backendHost} platformHost={platformHost}>
        <Component {...pageProps} />
      </RoqClientProvider>
    </RoqProvider>
  )
}
```

To make our Next.js project seamlessly work with ROQ Authentication, we need to configure the project first. Add file `pages/api/auth/[...roqAuth].ts` and fill with this code:

```ts filename="[...roqAuth].ts"
import { RoqAuth } from '@roq/nextjs';
export default RoqAuth({});
```

After that we can add a signup button, user will be redirected to the other page if the signup process successful.

```tsx filename="index.js"
import { useRoqClient } from 'lib/roq'

export default function Home() {
  const roqClient = useRoqClient()

  const handleSignUp = async () => {
     await roqClient.signUp('owner', { postLoginRedirect: '/book' })
  }

  return (
    <main>
       <h1>Add Signup</h1>
       <button onClick="{handleSignUp}">SignUp</button>
    </main>
  )
}
```

After successful signup, Next.js will get a token that will be used for any further request to the REST API from ROQ Baas.

<Callout type="info">
For more about authentication, please visit [**add authentication**](/next-js/add-authentication).
</Callout>

### Query data

For example, this is a snippet from the generated code for hook to find books with count data:

```ts filename="src/lib/roq/roq-hooks.ts"
export function useBookFindManyWithCount<
  T extends Prisma.bookFindManyArgs,
  R extends { data: GetFindResult<Prisma.$bookPayload<DefaultArgs>, T>[]; count: number },
>(args?: Prisma.SelectSubset<T, Prisma.bookFindManyArgs>, options?: RequestOptions, swrOptions?: SWRRequestOptions<R>) {
  const roq = useRoqClient();
  const key = JSON.stringify(['useBookFindManyWithCount', args || {}]);
  return useSWR<R, Error>(
    key,
    async () => {
      const result = await roq.book.findManyWithCount(args, options);
      return result as R;
    },
    {
      ...swrOptions,
      fallbackData: swrOptions?.initialData ?? swrOptions?.fallbackData,
    },
  );
}
```

To use the `useBookFindManyWithCount` method in a Next.js page, we need to import this code:

```ts
import { useRoqClient, useBookFindManyWithCount } from 'lib/roq';
```

and then use it, for example:

```ts 
const { data, error, isLoading, mutate } = useBookFindManyWithCount({
    orderBy: {
      created_at: 'desc',
    }
});
```
We can display the `data` in the `index.tsx` page:

```ts 
<div>
  {isLoading ? (
    <p>Loading...</p>
  ) : error ? (
    <p>Error: {error.message}</p>
  ) : (
    <>
      <h1>Book Titles</h1>
      <br />
      <ul>
        {data.data.map((book, index) => (
          <li key={book.id}>
            {index + 1}. {book.title} by {book.author} ({book.genre})
          </li>
        ))}
      </ul>
    </>
  )}
</div>
```

### Start the Next.js application

To start the development server, run this command:

```shell
npm run dev
```

And in the browser, go to `http://localhost:3000`. 

![Next.js Quickstart](/screenshots/nextjs-quickstart-demo.png)
</Steps>


{/*
You need a roq-session-cookie in the browser. You can copy paste the cookie from the existing generated app.
*/}