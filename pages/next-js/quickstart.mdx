import { Steps, Callout } from "nextra/components"

# Quickstart

Learn how to create a Next.js project using ROQ BaaS, install ROQ SDK, and query data from the ROQ BaaS.

{/*
### Configure user schema and roles

*/}
<Steps>
### Create a Next.js application

To create a new Next.js project. Run this command:

```shell
npx create-next-app@latest
```

And the follow along the installation questions:

```shell
What is your project named? roq-baas-nextjs
Would you like to use TypeScript? No / Yes
Would you like to use ESLint? No / Yes
Would you like to use Tailwind CSS? No / Yes
Would you like to use `src/` directory? No / Yes
Would you like to use App Router? (recommended) No / Yes
Would you like to customize the default import alias (@/*)? No / Yes
What import alias would you like configured? @/*
```

### Install ROQ BaaS SDK

Install the necessary ROQ BaaS SDK for our project, which is `@roq/nextjs` and `@roq/cli` packages. 

```shell
npm install @roq/nextjs --save
npm install @roq/cli --save-dev
```

### Setup `.env`

Besides SDK, we need to copy the environment file from the Console. Make sure to choose the appropriate environment for our project, copy the environment values, and save it to the `.env` file in our root Next.js project directory. 

{/*
<Callout type="info">
It's recommended to create a new environment whenever we develop new projects.
</Callout>
*/}

### Generate SDK

Our Next.js project will work with ROQ BaaS specifically by using the customize generated SDK. To generate it, run the command below:

```shell
npx @roq/cli generate
```
This command generates a customizable SDK based on the Prisma BaaS schema and chosen environment. The default location for the code generated is `src/lib/roq`.

![generate roq sdk](/screenshots/generate-sdk.png)

### Configure Next.js with ROQ authentication

To make our Next.js project seamlessly work with ROQ Authentication, we need to configure the project first. Add file `pages/api/auth/[...roqAuth].ts` and fill with this code:

```ts
import { RoqAuth } from '@roq/nextjs';
export default RoqAuth({});
```

### Query data

Before doing any data related query, we need to wrap the Next.js application with the `<RoqClientProvider>` context provider component. This provider enable the components in the application tree to access the customize generated SDK from our command earlier. You can put this code in `_app.tsx` file.

```jsx
<RoqClientProvider endpoint="">{children}</RoqClientProvider>
```


For example, this is a snippet from the generated code for hook to find books with count data:

```ts filename="src/lib/roq/roq-hooks.ts"
export function useBookFindManyWithCount<
  T extends Prisma.bookFindManyArgs,
  R extends { data: GetFindResult<Prisma.$bookPayload<DefaultArgs>, T>[]; count: number },
>(args?: Prisma.SelectSubset<T, Prisma.bookFindManyArgs>, options?: RequestOptions, swrOptions?: SWRRequestOptions<R>) {
  const roq = useRoqClient();
  const key = JSON.stringify(['useBookFindManyWithCount', args || {}]);
  return useSWR<R, Error>(
    key,
    async () => {
      const result = await roq.book.findManyWithCount(args, options);
      return result as R;
    },
    {
      ...swrOptions,
      fallbackData: swrOptions?.initialData ?? swrOptions?.fallbackData,
    },
  );
}
```

To use the `useBookFindManyWithCount` method in a Next.js page, we need to import this code:

```ts
import { useRoqClient, useBookFindManyWithCount } from 'lib/roq';
```

and then use it, for example:

```ts 
const { data, error, isLoading, mutate } = useBookFindManyWithCount({
	skip: params.pageNumber * params.pageSize,
    take: params.pageSize,
    orderBy: {
      created_at: 'desc',
    },
    ...queryParams,
});
```

Another simpler example is to use the `useRoqClient` method directly in the Next.js page:

```ts
const roqClient = useRoqClient();

const handleDelete = async (id: string) => {
    setDeleteError(null);
    try {
      await roqClient.book.delete({ where: { id } });
      await mutate();
    } catch (error) {
      setDeleteError(error);
    }
};
```




### Start the Next.js application

To start the development server run this command:

```shell
npm run dev
```

And in the browser, go to `http://localhost:3000`. 

{/*
Check the result
*/}
</Steps>
