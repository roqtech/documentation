import { Callout, Steps } from 'nextra/components'

# Add user invites

## Invitation process overview


```mermaid
graph TD
A[1. User Initiates Invite] --> B[2. Invite Sent]
B -->|Resend Option| B
B --> C[3. Recipient Receives Invite]
B --> G[6. Cancel Invitation]
C --> D[4. Invite Accepted or Rejected]
D -->|Rejected| F[7. End of Flow]
D -->|Accepted| E[5. Invite Confirmed]
E --> F
G --> F
```

The invitation process flow is outlined as a series of steps below:

<Steps>
### User Initiates Invite 

The process starts with a user's decision to send an invitation. To send any invitation later, we should know about which user sending the invitation and the tenant. We can query these data using the `findMany()` on `user` entity.

For example, we can find a user based on the email:

```tsx
const getUserData = async () => {
	const userData = await roqClient.user.findMany({
		where: {
			email: {
				equals: "t.justin@roq.tech"
			}
		}
	})
}
```

From the code we can get the response as an object:

```tsx
[
    {
        "id": "2aef5b13-b647-4ff4-b76f-a58d62cdb0ef",
        "email": "Francis43@roq.tech",
        "firstName": null,
        "lastName": null,
        "roq_user_id": "06077069-4193-4f2d-98e1-2c1354df9ba6",
        "tenant_id": "dc92f95d-42bd-45af-84a7-da227d694cbb",
        "created_at": "2023-10-19T09:46:27.664Z",
        "updated_at": "2023-10-19T09:46:27.664Z"
    }
]
```
We will use the `roq_user_id` and `tenant_id` data for the next step, which is sent invitation. By default the roles for invitee is the same with user who's sent the invitation.

### Invite Sent

The `sendUserInvites()` API is used to invite users and automatically also create a user invite.

```tsx
const status = async() => {
  await roqClient.roqPlatform.sendUserInvites({
    userInvites: {
      tenantId: 'dc92f95d-42bd-45af-84a7-da227d694cbb',
      userInvites: [{
        createdByUserId: '8b249b07-bdd9-43f7-a10e-ace10f27ff66',
        email: "wick.john@roq.tech",
        locale: "en-US"
      }]
    }
  })
} 
```
If the user invitation is success, we will get the response data:

```json
{
    "sendUserInvites": {
        "success": [
            {
                "acceptedByUserId": null,
                "createdAt": "2023-10-27T00:14:36.900Z",
                "createdByUserId": "8b249b07-bdd9-43f7-a10e-ace10f27ff66",
                "data": null,
                "email": "wick.john@roq.tech",
                "firstName": "",
                "id": "db7a682d-6dca-4259-b15b-83aef12d1f5c",
                "locale": "en-US",
                "lastName": "",
                "roleKeys": null,
                "status": "pending",
                "statusUpdatedAt": "2022-08-10T09:02:18.579Z",
                "tenantId": "dc92f95d-42bd-45af-84a7-da227d694cbb",
                "updatedAt": "2023-10-27T00:14:36.900Z",
                "userTokenId": "e9ff1946-6060-4917-911b-c571cd98466a"
            }
        ],
        "errors": []
    }
}
```

In case we want to resend the invitation, we can use the ID from the `sendUserInvites()` response and then resend the user invitation using `resendUserInvite()` API.

```tsx
const resendUserInvitationStatus = async() => {
    const userInviteModel = await roqClient.roqPlatform.resendUserInvite({
				userInviteId: "db7a682d-6dca-4259-b15b-83aef12d1f5c"
		})
}
```
{/*

```json
{
    "resendUserInvite": {
        "acceptedByUserId": null,
        "createdAt": "2023-10-27T00:14:36.900Z",
        "createdByUserId": "8b249b07-bdd9-43f7-a10e-ace10f27ff66",
        "data": null,
        "email": "wick.john@roq.tech",
        "firstName": "",
        "id": "db7a682d-6dca-4259-b15b-83aef12d1f5c",
        "locale": "en-US",
        "lastName": "",
        "roleKeys": [],
        "status": "pending",
        "statusUpdatedAt": "2022-08-10T09:02:18.579Z",
        "tenantId": "dc92f95d-42bd-45af-84a7-da227d694cbb",
        "updatedAt": "2023-10-27T00:14:36.900Z",
        "userTokenId": "e9ff1946-6060-4917-911b-c571cd98466a"
    }
}
```
*/}

### Recipient Receives Invite

The invitee gets a notification, typically via email or another communication channel.

### Invite Accepted or Rejected

The recipient can choose to either accept or decline the invitation.

### Invite Confirmed

If accepted, the system verifies the invitation, potentially involving further setup for the invitee.

### Cancel Invitation

At any point after sending the invite and before its acceptance, the inviter can opt to cancel the invitation.

### End of Flow

The process wraps up, either with the invitee successfully onboarded, the invitation declined, or the invitation canceled.

</Steps>

{/*Description is here*/}

## Querying the user invitation list

You can get all the user invites list using this `userInvites()` method API. You can limit the results and search the invitee by email, name, or keywords, etc.

For example, in the Next.js page, to get the the invitee list with the limit 10:

```tsx
import { useRoqClient } from '@roq/nextjs'

const roqClient = useRoqClient()

const userInvitesData = await roqClient.roqPlatform.userInvites({
  limit: 10
})
```

<Callout type="info">
Please note that the `userInvites()` method is part of the ROQ platform API and cannot be generated. However, you can also cancel the invitation in the ROQ Console. You can read the documentation of the `userInvites()` API [here](https://jupiter-pp.roq-platform.com/docs/#query-userInvites).
</Callout>