import { Steps } from 'nextra/components'

# How to save data in Next.js

In this tutorial we will building a form to save data to ROQ using Next.js. We will use the ROQ SDK to save data to the database. 

Let's build a simple SaaS for works marketplace for freelancers. The application will have two user roles: **Business Owner** and **Freelancer**. The **Business Owner** will be able to create projects and the **Freelancer** will be able to create a freelancer profile and apply to projects.

## Project setup

Before we start, make sure we generate a ROQ project using [AI Assistant](https://app.roq.dev/).

<Steps>
### App name and prompt

For this project, we will use these setup values:

* **App name**: Freelancer Inc.
* **Prompt**: Freelancer works marketplace saas application.

![app name and prompt](/screenshots/app-name-and-prompt.png)

### User setup

Next, we will create initial user roles: 

* **Business Owner**: The owner of the company.
* **Freelancer**: The freelancer that will work in the company and not belong to the company.

![user setup](/screenshots/user-setup.png)


### Project schema

For this tutorial we will use this project schema:

![freelancer project schema](/screenshots/freelancer-inc-project-schema.png)

We can edit schema later in project [Console](https://console.roq.tech/). For more information about schema, please read [schema editor](/schema-editor) documentation.

### Next.js quickstart

Make sure to follow the next steps in this tutorial to create a Next.js project:

- [Next.js Quickstart](/next-js#create-a-nextjs-application)

The quickstart will initialize our freelancer works marketplace project with signup, login, and logout features.

There are a few changes to the `index.tsx` for the login page. We need to replace the role for sign in and sign up process with the role we created in the project setup which is `business-owner` and change the redirect page `postLoginRedirect` to `/projects`:

```tsx {7, 11} filename="src/pages/index.tsx"
import { useRoqClient } from "lib/roq";

export default function Home() {
  const roqClient = useRoqClient();

  const handleSignUp = async () => {
    await roqClient.signUp('business-owner', { postLoginRedirect: '/projects' });
  };

  const handleSignIn = async () => {
    await roqClient.signIn('business-owner', { postLoginRedirect: '/projects' });
  };

  return (
    {/* the code here is the same as before */}
  );
}
```

</Steps>

## Basic save data concepts

There are two kind of ways to save data to ROQ: save data with relations and save data without relations.

### Save data with relations

When dealing with more complex data structures, you might need to save data that includes relationships with other entities. ROQ SDK supports this operation, allowing you to create or update data along with its related entities in a single transaction.

For example, the business owner can create a project with the following code:

```tsx
const company_id = "22d80a45-0cf6-445d-a5db-f1091c6cb5d6"

const project = await roqClient.project.create({
    data: {
        id: uuidv4(),
        name: 'AI Chatbot',
        description: 'AI Chatbot for customer service',
        status: 'open',
        created_at: new Date(),
        updated_at: new Date(),
        company_id: company_id,
        deadline: new Date("2024-10-31"),
        task: {
            create: [
                {
                    id: uuidv4(),
                    name: 'Project setup',
                    description: 'Setup the project',
                    created_at: new Date(),
                    updated_at: new Date(),
                    status: 'open',
                }
            ]
        }
    }
});
```

Based on our previous project schema, it's clear that this project shares a relationship with the company entity while it may also relate to the task entity, depending on the situation. To create a new project with associated tasks, we must provide the project entity with the company ID as well as the task entity.

### Save data without relations

When dealing with simple data structures, you might need to save data that does not include relationships with other entities. ROQ SDK supports this operation, allowing you to create or update data in a single transaction.

For example, to update a company data, we can use the following code:

{/*
[
    {
        "id": "22d80a45-0cf6-445d-a5db-f1091c6cb5d6",
        "description": null,
        "location": null,
        "industry": null,
        "size": null,
        "name": "Freelancer Inc.",
        "created_at": "2023-11-10T08:38:53.524Z",
        "updated_at": "2023-11-10T08:38:53.524Z"
    }
]

*/}

```tsx
const updateCompany = async () => {
    const updateCompanyResult = await roqClient.company.update({
	    data: { 
			description: "Top projects marketplace where you can work everywhere.",
			location: "Worldwide", 
			industry: "Internet", size: "1001-5000" },
		    where: {
			    id: "22d80a45-0cf6-445d-a5db-f1091c6cb5d6"
		}
	},)
}
```

From our previous project schema, this company does not have any relations, so we can update it directly in other words, we can update it without relations.

## Building project form

Now that we have a basic understanding of how to save data to ROQ, let's build a form to save data to ROQ. 

### Create a project form component

Create a `project-form.tsx` file in the same folder as `index.tsx` and add the following code:

```tsx filename="src/pages/project-form.tsx"
import React from 'react';

export default function ProjectForm({ projectData, onSubmit }) {

	const handleSubmit = (e) => {
		e.preventDefault();
		const formData = {
			name: e.target.name.value,
			description: e.target.description.value,
			status: e.target.status.value,
			deadline: e.target.deadline.value,
		  };
	  
		onSubmit(formData);
	};

	return (
		<div className="flex flex-col justify-center items-center h-screen bg-zinc-950 px-4">
			<div className="w-full max-w-lg">
				<h1 className="text-white text-xl font-bold my-4">Create Project</h1>
				<form onSubmit={handleSubmit} className="flex flex-col gap-4 bg-zinc-800 p-6 rounded shadow-lg w-full max-w-lg">
					<div className="flex flex-col gap-2">
						<label htmlFor="name" className="text-gray-400">Name</label>
						<input type="text" id="name" defaultValue={projectData.name} className="bg-zinc-950 text-white border border-gray-600 rounded p-2" />
					</div>

					<div className="flex flex-col gap-2">
						<label htmlFor="description" className="text-gray-400">Description</label>
						<textarea id="description" defaultValue={projectData.description} className="bg-zinc-950 text-white border border-gray-600 rounded p-2" />
					</div>

					<div className="flex flex-col gap-2">
						<label htmlFor="status" className="text-gray-400">Status</label>
						<select id="status" defaultValue={projectData.status} className="bg-zinc-950 text-white border border-gray-600 rounded p-2">
						    <option value="open">Open</option>
							<option value="inprogress">In Progress</option>
							<option value="active">Active</option>
							<option value="inactive">Inactive</option>
							<option value="completed">Completed</option>
							<option value="cancelled">Cancelled</option>
							<option value="onhold">On Hold</option>
							<option value="pending">Pending</option>
						</select>
					</div>

					<div className="flex flex-col gap-2">
						<label htmlFor="deadline" className="text-gray-400">Deadline</label>
						<input type="date" id="deadline" defaultValue={projectData.deadline ? projectData.deadline.split('T')[0] : ''} className="bg-zinc-950 text-white border border-gray-600 rounded p-2" />
					</div>

					<button type="submit" className="px-4 py-2 bg-indigo-500 text-white rounded shadow">Save</button>
				</form>
			</div>
		</div>
	);
}
```

This component basically renders a form with the project data and a submit button. The `onSubmit` prop is a function that will be called when the form is submitted. The project form only create a new project with a company relation but without relation such as task entity.

### Create a project page

To use the `ProjectForm` component, we need to create a page that renders the form. Create a `projects.tsx` file in the same folder as `index.tsx`, `project-form.tsx` and add the following code:

```tsx filename="src/pages/projects.tsx"
import { useRoqClient } from 'lib/roq';
import { useSession } from '@roq/nextjs';
import { useEffect, useState } from 'react';
import { v4 as uuidv4 } from 'uuid';
import ProjectForm from './project-form'
import { get } from 'http';

interface ProjectData {
	id: string;
	name: string;
	description: string;
	deadline: string | null;
	status: 'active' | 'inactive' | 'completed' | 'pending' | 'on hold' | 'cancelled';
	company_id: string;
	created_at: string;
	updated_at: string;
  }  

export default function Freelancer() {
  const roqClient = useRoqClient();
  const { session } = useSession();
  const roles = session?.user.roles || [];
  const [currentProject, setCurrentProject] = useState([]);
  const company_id = session?.user.tenantId;

  const logoutHandler = () => {
    roqClient.signOut();
  };

  const handleFormSubmit = async (projectData: ProjectData) => {
    try {
      const projectId = uuidv4();
	  projectData.id = projectId;
      console.log(projectData);
    } catch (error) {
      console.error('Error submitting project:', error);
    }
  };
 
  return (
	<div className="flex flex-col w-full h-screen bg-zinc-950">
	<nav className="flex justify-between items-center p-4 bg-zinc-800 shadow">
	  <h1 className="text-white text-xl font-bold">Freelancer Inc.</h1>
	  <div className="flex items-center gap-4">
		<div>
		  <p className="text-gray-400 text-sm">
			Logged in as: <span className="text-white">{session?.user.email}</span>
		  </p>
		  <p className="text-gray-400 text-sm">
			Role: <span className="text-white">{roles[0]}</span>
		  </p>
		</div>
		<button onClick={logoutHandler} className="px-3 py-1 bg-indigo-500 rounded shadow text-white font-bold">
		  Log out
		</button>
	  </div>
	</nav>
	<ProjectForm projectData={currentProject} onSubmit={handleFormSubmit} />
  </div>
  
  );
}
```

This page renders the `ProjectForm` component and passes the `handleFormSubmit` function as the `onSubmit` prop. The `handleFormSubmit` function will be called when the form is submitted and it will save the project data to ROQ.

![project page](/screenshots/add-project-page.png)



